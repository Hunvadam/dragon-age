<form class="dragon-age sheet {{cssClass}}" autocomplete="off">

  <!-- ===== HEADER: Portrait + Name ===== -->
  <header class="sheet-header">
    <div class="profile-img">
      <img src="{{actor.img}}" data-edit="img" title="{{actor.name}}"/>
    </div>

    <h1>
      <input name="name" type="text" value="{{actor.name}}" placeholder="Name"/>
    </h1>

    {{!-- NPC RACE SELECTOR --}}
    <div class="npc-race-select">
      <label>Race</label>
      <select name="system.race">
        {{#select actor.system.race}}
          <option value="human">Human</option>
          <option value="darkspawn">Darkspawn</option>
        {{/select}}
      </select>
    </div>

    {{!-- NPC CLASS SELECTOR --}}
    <div class="npc-class-select">
      <label>Class</label>
      <select name="system.class">
        {{#select actor.system.class}}
          <option value="warrior">Warrior</option>
          <option value="rogue">Rogue</option>
          <option value="mage">Mage</option>
          <option value="barbarian">Barbarian</option>
          <option value="battlewright">Battlewright</option>
          <option value="champion">Champion</option>
          <option value="templar">Templar</option>
        {{/select}}
      </select>
    </div>
  </header>

  {{!-- NPC LEVEL + LEVEL UP BUTTON --}}
  <div class="npc-level-row">
    <label>Level</label>
    <input type="number"
           name="system.level"
           value="{{actor.system.level}}"
           data-dtype="Number"
           style="width: 50px;"/>

    <button type="button" class="npc-level-up">
      Level Up
    </button>
  </div>

  <!-- ===== RESOURCES: Health + Dynamic Resource ===== -->
  <section class="box">
    <h2>{{localize "DragonAge.Resources"}}</h2>
    <div class="stat-column">
      <div>
        <label>{{localize "DragonAge.Health"}}</label>
        <input type="number" name="system.resources.health.value" value="{{actor.system.resources.health.value}}" data-dtype="Number" style="width:55px;"/>
        <span>/</span>
        <input type="number" name="system.resources.health.max" value="{{actor.system.resources.health.max}}" data-dtype="Number" style="width:55px;"/>
      </div>

      <div>
        <label>{{resourceLabel}}</label>
        <input type="number" name="system.resources.stamina.value" value="{{actor.system.resources.stamina.value}}" data-dtype="Number" style="width:55px;"/>
        <span>/</span>
        <input type="number" name="system.resources.stamina.max" value="{{actor.system.resources.stamina.max}}" data-dtype="Number" style="width:55px;"/>
      </div>
    </div>
  </section>

  {{!-- ===== TABS NAV ===== --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="stats">Stats</a>
    <a class="item" data-tab="inventory">Inventory</a>
  </nav>

  <section class="sheet-body">

    {{!-- =========================
         STATS TAB
         ========================= --}}
    <div class="tab" data-group="primary" data-tab="stats">

      <div class="grid-2">
        <!-- ===== Left Column: Attributes ===== -->
        <section class="box">
          <h2>{{localize "DragonAge.Attributes"}}</h2>
          <div class="stat-column">
            <div>
              <label>{{localize "DragonAge.Str"}}</label>
              <input type="number" name="system.attributes.strength" value="{{actor.system.attributes.strength}}" data-dtype="Number"/>
              <span class="attr-mod">({{actor.system.derived.mods.strength}})</span>
            </div>
            <div>
              <label>{{localize "DragonAge.Dex"}}</label>
              <input type="number" name="system.attributes.dexterity" value="{{actor.system.attributes.dexterity}}" data-dtype="Number"/>
              <span class="attr-mod">({{actor.system.derived.mods.dexterity}})</span>
            </div>
            <div>
              <label>{{localize "DragonAge.Con"}}</label>
              <input type="number" name="system.attributes.constitution" value="{{actor.system.attributes.constitution}}" data-dtype="Number"/>
              <span class="attr-mod">({{actor.system.derived.mods.constitution}})</span>
            </div>
            <div>
              <label>{{localize "DragonAge.Int"}}</label>
              <input type="number" name="system.attributes.intelligence" value="{{actor.system.attributes.intelligence}}" data-dtype="Number"/>
              <span class="attr-mod">({{actor.system.derived.mods.intelligence}})</span>
            </div>
            <div>
              <label>{{localize "DragonAge.Wis"}}</label>
              <input type="number" name="system.attributes.wisdom" value="{{actor.system.attributes.wisdom}}" data-dtype="Number"/>
              <span class="attr-mod">({{actor.system.derived.mods.wisdom}})</span>
            </div>
            <div>
              <label>{{localize "DragonAge.Cha"}}</label>
              <input type="number" name="system.attributes.charisma" value="{{actor.system.attributes.charisma}}" data-dtype="Number"/>
              <span class="attr-mod">({{actor.system.derived.mods.charisma}})</span>
            </div>
            <div>
              <label>{{localize "DragonAge.Mag"}}</label>
              <input type="number" name="system.attributes.magic" value="{{actor.system.attributes.magic}}" data-dtype="Number"/>
              <span class="attr-mod">({{actor.system.derived.mods.magic}})</span>
            </div>
          </div>
        </section>

        <!-- ===== DEFENSE: Armor / Dodge / Weapon Damage / Initiative ===== -->
        <section class="box">
          <h2>{{localize "DragonAge.Defense"}}</h2>
          <div class="stat-column">
            <div><label>{{localize "DragonAge.Armor"}}</label><input type="number" name="system.defense.armor" value="{{actor.system.defense.armor}}" data-dtype="Number"/></div>
            <div><label>{{localize "DragonAge.Dodge"}}</label><input type="number" name="system.defense.dodge" value="{{actor.system.defense.dodge}}" data-dtype="Number"/></div>
            <div><label>{{localize "DragonAge.WeaponDamage"}}</label><input type="text" name="system.weapon.damage" value="{{actor.system.weapon.damage}}"/></div>
            <div><label>{{localize "DragonAge.Initiative"}}</label><input type="number" name="system.initiative.flat" value="{{actor.system.initiative.flat}}" data-dtype="Number"/></div>
          </div>
        </section>

        <h2 style="margin-top:12px">{{localize "DragonAge.Resistances"}}</h2>
        <div class="stat-column">
          <div><label>{{localize "DragonAge.Fire"}}</label><input type="number" name="system.resistances.fire" value="{{actor.system.resistances.fire}}" data-dtype="Number"/></div>
          <div><label>{{localize "DragonAge.Cold"}}</label><input type="number" name="system.resistances.cold" value="{{actor.system.resistances.cold}}" data-dtype="Number"/></div>
          <div><label>{{localize "DragonAge.Nature"}}</label><input type="number" name="system.resistances.nature" value="{{actor.system.resistances.nature}}" data-dtype="Number"/></div>
          <div><label>{{localize "DragonAge.Spirit"}}</label><input type="number" name="system.resistances.spirit" value="{{actor.system.resistances.spirit}}" data-dtype="Number"/></div>
          <div><label>{{localize "DragonAge.Electricity"}}</label><input type="number" name="system.resistances.electricity" value="{{actor.system.resistances.electricity}}" data-dtype="Number"/></div>
          <div><label>{{localize "DragonAge.Blight"}}</label><input type="number" name="system.resistances.blight" value="{{actor.system.resistances.blight}}" data-dtype="Number"/></div>
        </div>

        <h2 style="margin-top:12px">{{localize "DragonAge.Saves"}}</h2>
        <div class="stat-column">
          <div><label>{{localize "DragonAge.Fortitude"}}</label><input type="number" name="system.saves.fortitude" value="{{actor.system.saves.fortitude}}" data-dtype="Number"/></div>
          <div><label>{{localize "DragonAge.Reflex"}}</label><input type="number" name="system.saves.reflex" value="{{actor.system.saves.reflex}}" data-dtype="Number"/></div>
          <div><label>{{localize "DragonAge.Will"}}</label><input type="number" name="system.saves.will" value="{{actor.system.saves.will}}" data-dtype="Number"/></div>
        </div>
      </div>

      <section class="box notes" style="margin-top:12px">
        <h2>{{localize "DragonAge.Notes"}}</h2>
        <textarea name="system.notes">{{actor.system.notes}}</textarea>
      </section>

      {{!-- NPC-specific trade/info block --}}
      <section class="npc-extra-grid">
        <h2>NPC Items</h2>

        <table class="npc-items-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Cost</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <input type="text"
                       name="system.npcItem.name"
                       value="{{actor.system.npcItem.name}}"
                       placeholder="Item name" />
              </td>
              <td>
                <input type="text"
                       name="system.npcItem.cost"
                       value="{{actor.system.npcItem.cost}}"
                       placeholder="Cost" />
              </td>
              <td>
                <textarea name="system.npcItem.description"
                          rows="2"
                          placeholder="Description">{{actor.system.npcItem.description}}</textarea>
              </td>
            </tr>
          </tbody>
        </table>
      </section>

    </div>

    {{!-- =========================
         INVENTORY TAB
         ========================= --}}
    <div class="tab" data-group="primary" data-tab="inventory">

      <section class="box">
        <h2>Inventory</h2>

        <div class="box" style="margin-bottom:12px">
          <h2>Currency</h2>
          <label>Gold</label>
          <input type="number" name="system.currency.gold" value="{{gold}}" data-dtype="Number" style="width:90px"/>
        </div>

        <div class="box">
          <h2>Equipped</h2>

          <table class="equipped-grid">
            <thead>
              <tr>
                <th style="width:25%">Slot</th>
                <th style="width:25%">Item</th>
                <th style="width:25%">Slot</th>
                <th style="width:25%">Item</th>
              </tr>
            </thead>
            <tbody>

              <tr>
                <td>Helmet</td>
                <td>
                  {{#with equippedBySlot.helmet}}
                    <div class="item flexrow" data-item-id="{{_id}}">
                      <div class="item-name">{{name}}</div>
                      <div class="item-controls">
                        <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                      </div>
                    </div>
                  {{else}}—{{/with}}
                </td>

                <td>Main Hand</td>
                <td>
                  {{#with equippedBySlot.mainHand}}
                    <div class="item flexrow" data-item-id="{{_id}}">
                      <div class="item-name">{{name}}</div>
                      <div class="item-controls">
                        <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                      </div>
                    </div>
                  {{else}}—{{/with}}
                </td>
              </tr>

              <tr>
                <td>Armor</td>
                <td>
                  {{#with equippedBySlot.armor}}
                    <div class="item flexrow" data-item-id="{{_id}}">
                      <div class="item-name">{{name}}</div>
                      <div class="item-controls">
                        <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                      </div>
                    </div>
                  {{else}}—{{/with}}
                </td>

                <td>Off Hand</td>
                <td>
                  {{#with equippedBySlot.offHand}}
                    <div class="item flexrow" data-item-id="{{_id}}">
                      <div class="item-name">{{name}}</div>
                      <div class="item-controls">
                        <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                      </div>
                    </div>
                  {{else}}—{{/with}}
                </td>
              </tr>

              <tr>
                <td>Gloves</td>
                <td>
                  {{#with equippedBySlot.gloves}}
                    <div class="item flexrow" data-item-id="{{_id}}">
                      <div class="item-name">{{name}}</div>
                      <div class="item-controls">
                        <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                      </div>
                    </div>
                  {{else}}—{{/with}}
                </td>

                <td>Bow</td>
                <td>
                  {{#with equippedBySlot.bow}}
                    <div class="item flexrow" data-item-id="{{_id}}">
                      <div class="item-name">{{name}}</div>
                      <div class="item-controls">
                        <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                      </div>
                    </div>
                  {{else}}—{{/with}}
                </td>
              </tr>

              <tr>
                <td>Boots</td>
                <td>
                  {{#with equippedBySlot.boots}}
                    <div class="item flexrow" data-item-id="{{_id}}">
                      <div class="item-name">{{name}}</div>
                      <div class="item-controls">
                        <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                      </div>
                    </div>
                  {{else}}—{{/with}}
                </td>

                <td>Arrow/Bolt</td>
                <td>
                  {{#with equippedBySlot.ammo}}
                    <div class="item flexrow" data-item-id="{{_id}}">
                      <div class="item-name">{{name}}</div>
                      <div class="item-controls">
                        <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                      </div>
                    </div>
                  {{else}}—{{/with}}
                </td>
              </tr>

              <tr>
                <td>Amulet</td>
                <td>
                  {{#with equippedBySlot.amulet}}
                    <div class="item flexrow" data-item-id="{{_id}}">
                      <div class="item-name">{{name}}</div>
                      <div class="item-controls">
                        <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                      </div>
                    </div>
                  {{else}}—{{/with}}
                </td>

                <td>Shield</td>
                <td>
                  {{#with equippedBySlot.shield}}
                    <div class="item flexrow" data-item-id="{{_id}}">
                      <div class="item-name">{{name}}</div>
                      <div class="item-controls">
                        <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                      </div>
                    </div>
                  {{else}}—{{/with}}
                </td>
              </tr>

              <tr>
                <td>Belt</td>
                <td>
                  {{#with equippedBySlot.belt}}
                    <div class="item flexrow" data-item-id="{{_id}}">
                      <div class="item-name">{{name}}</div>
                      <div class="item-controls">
                        <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                      </div>
                    </div>
                  {{else}}—{{/with}}
                </td>

                <td>Left Pouch</td>
                <td>
                  {{#with equippedBySlot.leftPouch}}
                    <div class="item flexrow" data-item-id="{{_id}}">
                      <div class="item-name">{{name}}</div>
                      <div class="item-controls">
                        <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                      </div>
                    </div>
                  {{else}}—{{/with}}
                </td>
              </tr>

              <tr>
                <td>Left Ring</td>
                <td>
                  {{#with equippedBySlot.leftRing}}
                    <div class="item flexrow" data-item-id="{{_id}}">
                      <div class="item-name">{{name}}</div>
                      <div class="item-controls">
                        <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                      </div>
                    </div>
                  {{else}}—{{/with}}
                </td>

                <td>Right Pouch</td>
                <td>
                  {{#with equippedBySlot.rightPouch}}
                    <div class="item flexrow" data-item-id="{{_id}}">
                      <div class="item-name">{{name}}</div>
                      <div class="item-controls">
                        <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                      </div>
                    </div>
                  {{else}}—{{/with}}
                </td>
              </tr>

              <tr>
                <td>Right Ring</td>
                <td>
                  {{#with equippedBySlot.rightRing}}
                    <div class="item flexrow" data-item-id="{{_id}}">
                      <div class="item-name">{{name}}</div>
                      <div class="item-controls">
                        <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                      </div>
                    </div>
                  {{else}}—{{/with}}
                </td>

                <td>Set Bonus</td>
                <td>
                  {{#with equippedBySlot.setBonus}}
                    <div class="item flexrow" data-item-id="{{_id}}">
                      <div class="item-name">{{name}}</div>
                      <div class="item-controls">
                        <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                      </div>
                    </div>
                  {{else}}—{{/with}}
                </td>
              </tr>

            </tbody>
          </table>

          <p style="opacity:.8;margin-top:6px">
            UI-only. Set an item’s “Equipped Slot” in the item sheet to show it here.
          </p>
        </div>

        <div class="box" style="margin-top:12px">
          <h2>Storage</h2>

          <h3>Weapons</h3>
          <ol class="items-list">
            {{#each storage.weapons as |it|}}
              <li class="item flexrow" data-item-id="{{it._id}}">
                <div class="item-name">{{it.name}}</div>
                <div class="item-controls">
                  <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                  <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                </div>
              </li>
            {{/each}}
          </ol>

          <h3>Equipment</h3>
          <ol class="items-list">
            {{#each storage.equipment as |it|}}
              <li class="item flexrow" data-item-id="{{it._id}}">
                <div class="item-name">{{it.name}}</div>
                <div class="item-controls">
                  <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                  <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                </div>
              </li>
            {{/each}}
          </ol>

          <h3>Consumables</h3>
          <ol class="items-list">
            {{#each storage.consumables as |it|}}
              <li class="item flexrow" data-item-id="{{it._id}}">
                <div class="item-name">{{it.name}}</div>
                <div class="item-controls">
                  <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                  <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                </div>
              </li>
            {{/each}}
          </ol>

          <h3>Items</h3>
          <ol class="items-list">
            {{#each storage.items as |it|}}
              <li class="item flexrow" data-item-id="{{it._id}}">
                <div class="item-name">{{it.name}}</div>
                <div class="item-controls">
                  <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                  <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                </div>
              </li>
            {{/each}}
          </ol>

          <h3>Magical Items</h3>
          <ol class="items-list">
            {{#each storage.magical as |it|}}
              <li class="item flexrow" data-item-id="{{it._id}}">
                <div class="item-name">{{it.name}}</div>
                <div class="item-controls">
                  <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                  <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                </div>
              </li>
            {{/each}}
          </ol>
        </div>

        <p style="opacity:0.8; margin-top:8px;">
          Drag &amp; drop Items onto this NPC to add them to inventory.
        </p>

      </section>

    </div>

  </section>
</form>
